#!/bin/sh
# 初始化 keepalived-ha 默认配置（仅首次运行）
CFGFILE="/etc/config/keepalived-ha"

# 如果已有配置就跳过
[ -f "$CFGFILE" ] && exit 0

uci -q batch <<'EOF'
set keepalived-ha.general=general
set keepalived-ha.general.role='main'
set keepalived-ha.general.vip='192.168.1.5'
set keepalived-ha.general.interface='br-lan'
set keepalived-ha.general.check_method='ping'
set keepalived-ha.general.vrid='51'
set keepalived-ha.general.advanced_mode='0'
set keepalived-ha.general.preempt='true'
set keepalived-ha.general.control_openclash='1'

set keepalived-ha.main=main
set keepalived-ha.main.peer_ip='192.168.1.3'
set keepalived-ha.main.priority='50'
set keepalived-ha.main.fail_threshold='3'
set keepalived-ha.main.recover_threshold='2'
set keepalived-ha.main.check_interval='5'

set keepalived-ha.peer=peer
set keepalived-ha.peer.main_ip='192.168.1.2'
set keepalived-ha.peer.priority='100'
EOF

uci commit keepalived-ha
exit 0
