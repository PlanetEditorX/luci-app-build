<!-- /usr/lib/lua/luci/view/keepalived-ha/role_confirm.htm -->
<script type="text/javascript">
    // 角色切换确认并自动提交
    function confirmRoleChange(selectElement) {
        // 1. 获取新选择的角色名称（如“主路由”“备路由”）
        const newRoleText = selectElement.options[selectElement.selectedIndex].text;

        // 2. 弹出确认对话框
        const isConfirm = confirm(`确定切换为【${newRoleText}】吗？\n切换后将自动保存配置并刷新页面，无需手动点击保存。`);

        if (isConfirm) {
            // 3. 找到页面中的配置表单（LuCI 默认表单）
            const configForm = document.querySelector('form[action*="apply"]') || document.querySelector('form');
            if (configForm) {
                // 4. 添加隐藏字段标记“角色切换”（可选，用于后续逻辑区分）
                const hiddenMark = document.createElement('input');
                hiddenMark.type = 'hidden';
                hiddenMark.name = 'auto_save_role_change';
                hiddenMark.value = '1';
                configForm.appendChild(hiddenMark);

                // 5. 自动提交表单（保存配置）
                configForm.submit();
            }
            return true;
        } else {
            // 6. 取消切换时，恢复原始选择值
            const originalRole = selectElement.getAttribute('data-original');
            if (originalRole) {
                selectElement.value = originalRole;
            }
            return false;
        }
    }

    // 页面加载完成后，记录初始角色值（用于取消切换时恢复）
    document.addEventListener('DOMContentLoaded', function() {
        // 找到角色选择下拉框（匹配 name 包含“role”的 select 元素）
        const roleSelect = document.querySelector('select[name*="role"]');
        if (roleSelect) {
            // 存储初始值到自定义属性
            roleSelect.setAttribute('data-original', roleSelect.value);
        }
    });
    </script>

    <!-- 隐藏空内容占位符，避免页面显示空白块 -->
    <style>
    .role-confirm-placeholder { display: none; }
    </style>
    <div class="role-confirm-placeholder"></div>